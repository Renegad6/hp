#!/bin/sh 
# $Header:$
# sync current folder with remote one (remote -> local).Must have a 'rrsync' file on current folder.

getScriptPath () {
  echo ${0%/*}/
}

if [ -z "$AE_SANDBOX_PATH" ]
then
    echo "ae_init_sandbox not performed, impossible to detect risks!!!";
    exit -1;
fi;

if [ "$AE_SANDBOX_PATH" = "$PWD" ];
then
    echo "trying sync from REAL!!! sandbox!!";
fi;

ORIG=$MYSBOX;
DEST=$AE_SANDBOX_PATH;
FLAGS="-a --delete"

if [ "$1" = "-r" ];
then
    result=`svn status -q $AE_SANDBOX_PATH`
    [ ! -z "$result" ] && echo "sandbox tainted!!" && exit -1
    TMP=$ORIG;
    ORIG=$DEST;
    DEST=$TMP;
fi;

if [ "$1" = "-c" ];
then
    diff --brief -r $ORIG $DEST|grep -v "^Only";
    exit 0;
fi;

echo "ORIG:"$ORIG;
echo "DEST:"$DEST;

for d in bcd_io bcd_views elektra foundation printerInterface products;
do
    echo "d:"$d;
    rsync $FLAGS --exclude-from .gitignore --exclude-from ign.endings $ORIG/$d/ $DEST/$d/
done;

exit 0;
